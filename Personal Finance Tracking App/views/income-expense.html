<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css?family=Expressway:100,300,400,600" rel="stylesheet" type="text/css">
    <link href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" type="text/css">
    <link type="text/css" rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="logo.png" type="image/png">
</head>
    <body>
        <div class="navbar">
            <div class="title">Personal Finance Tracker</div>
            <div class="nav-buttons">
                <button onclick="window.location.href='Summary.html'">Summary</button>
                <button onclick="window.location.href='income-expense.html'">Income/Expense</button>
                <button onclick="window.location.href='account-settings.html'">Profile</button>
                <button onclick="signOut()">Sign Out</button>
            </div>
    </div>

    <div class="bottom">
        <div class="add">
            <div class="add__container">
                <select class="add__type">
                    <option value="inc" selected>+</option>
                    <option value="exp">-</option>
                </select>
                <input type="text" class="add__description" placeholder="Add description">
                <input type="number" class="add__value" placeholder="Value">
                <button class="add__btn"><i class="ion-ios-checkmark-outline"></i></button>
            </div>
        </div>
        
        <div class="container clearfix">
            <div class="income">
                <h2 class="income__title">Income</h2>
                <div class="income__list">
                    <ul></ul>
                </div>
            </div>
            
            <div class="expenses">
                <h2 class="expenses__title">Expenses</h2>
                <div class="expenses__list">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let totalIncome = 0;
        let totalExpenses = 0;

        document.addEventListener('DOMContentLoaded', () => {
            const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
            if (!loggedInUser) {
                window.location.href = 'homepage.html';
                return;
            }

            const monthNames = [
                "January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];
            const now = new Date();
            const currentMonth = monthNames[now.getMonth()];
            document.getElementById('current-month').textContent = currentMonth;
        });

        document.querySelector('.add__btn').addEventListener('click', addItem);

        function addItem() {
            const type = document.querySelector('.add__type').value;
            const description = document.querySelector('.add__description').value;
            const value = parseFloat(document.querySelector('.add__value').value);

            if (description !== "" && !isNaN(value) && value > 0) {
                const list = type === 'inc' ? document.querySelector('.income__list ul') : document.querySelector('.expenses__list ul');
                const html = `
                    <li class="item clearfix">
                        <div class="item__description">${description}</div>
                        <div class="right clearfix">
                            <div class="item__value">${type === 'inc' ? '+' : '-'} ${value.toFixed(2)}</div>
                            <div class="item__delete">
                                <button class="item__delete--btn"><i class="ion-ios-close-outline"></i></button>
                            </div>
                        </div>
                    </li>
                `;
                list.insertAdjacentHTML('beforeend', html);

                if (type === 'inc') {
                    totalIncome += value;
                } else {
                    totalExpenses += value;
                }

                updateBudget();
                clearFields();
            }
        }

        function updateBudget() {
            const budget = totalIncome - totalExpenses;
            const total = totalIncome + totalExpenses;
            const incomePercentage = total > 0 ? Math.round((totalIncome / total) * 100) : 0;
            const expensesPercentage = total > 0 ? Math.round((totalExpenses / total) * 100) : 0;

            document.getElementById('budget-value').textContent = `${budget >= 0 ? '+' : '-'} ${Math.abs(budget).toFixed(2)}`;
            document.getElementById('income-value').textContent = `+ ${totalIncome.toFixed(2)}`;
            document.getElementById('income-percentage').textContent = `${incomePercentage}%`;
            document.getElementById('expenses-value').textContent = `- ${totalExpenses.toFixed(2)}`;
            document.getElementById('expenses-percentage').textContent = `${expensesPercentage}%`;
        }

        function clearFields() {
            document.querySelector('.add__description').value = '';
            document.querySelector('.add__value').value = '';
            document.querySelector('.add__description').focus();
        }

        function signOut() {
            localStorage.removeItem('loggedInUser');
            window.location.href = 'homepage.html';
        }
    </script>
</body>
</html>